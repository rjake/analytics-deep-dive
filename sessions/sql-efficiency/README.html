<!DOCTYPE html>
<html lang="en"><head>
<script src="README_files/libs/clipboard/clipboard.min.js"></script>
<script src="README_files/libs/quarto-html/tabby.min.js"></script>
<script src="README_files/libs/quarto-html/popper.min.js"></script>
<script src="README_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="README_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="README_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="README_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.0.36">

  <meta name="author" content="Jake Riley 9/9/2022">
  <title>SQL Efficiency</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="README_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="README_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #f07178; background-color: #2a0f15; font-weight: bold; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #00e0e0; } /* Attribute */
    code span.bn { color: #d4d0ab; } /* BaseN */
    code span.bu { color: #abe338; } /* BuiltIn */
    code span.cf { color: #ffa07a; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffd700; } /* Constant */
    code span.co { color: #f8f8f2; font-style: italic; } /* Comment */
    code span.cv { color: #ffd700; } /* CommentVar */
    code span.do { color: #f8f8f2; } /* Documentation */
    code span.dt { color: #ffa07a; } /* DataType */
    code span.dv { color: #d4d0ab; } /* DecVal */
    code span.er { color: #f07178; text-decoration: underline; } /* Error */
    code span.ex { color: #00e0e0; font-weight: bold; } /* Extension */
    code span.fl { color: #d4d0ab; } /* Float */
    code span.fu { color: #ffa07a; } /* Function */
    code span.im { color: #abe338; } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; font-weight: bold; } /* Keyword */
    code span.op { color: #ffa07a; } /* Operator */
    code span.ot { color: #00e0e0; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.re { color: #00e0e0; background-color: #f8f8f2; } /* RegionMarker */
    code span.sc { color: #abe338; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #00e0e0; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #dcc6e0; } /* Warning */
  </style>
  <link rel="stylesheet" href="README_files/libs/revealjs/dist/theme/quarto.css" id="theme">
  <link href="README_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="README_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="README_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="README_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-captioned.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-captioned) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-captioned.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-captioned .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-captioned .callout-caption  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-captioned.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-captioned.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-caption {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-caption {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-caption {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-captioned .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-captioned .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-captioned) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-caption {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-caption {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-caption {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-caption {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-caption {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="README_files/libs/quarto-diagram/mermaid.min.js"></script>
  <script src="README_files/libs/quarto-diagram/mermaid-init.js"></script>
  <link href="README_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="center">
  <h1 class="title">SQL Efficiency</h1>
  <p class="author">Jake Riley 9/9/2022</p>
</section>

<section id="agenda" class="slide level2">
<h2>Agenda</h2>
<ul>
<li><a href="https://rjake.github.io/analytics-deep-dive/sessions/sql-efficiency/README.html#1">slides</a> | <a href="https://www.github.com/rjake/analytics-deep-dive/blob/main/sessions/sql-efficiency/README.md">code</a></li>
<li></li>
<li></li>
</ul>
</section>
<section id="why-are-we-here" class="slide level2">
<h2>Why are we here?</h2>
<ul>
<li>morning runtime</li>
<li>tech debt</li>
<li>professional development</li>
</ul>
</section>
<section id="some-new-terms" class="slide level2 advanced">
<h2>Some new terms</h2>
<h4 id="optimizer">“optimizer”</h4>
<p>even though you wrote a nice logical piece of code, the optimizer will rearrange things to be more efficient <br><br></p>
<h4 id="cost">“cost”</h4>
<p>the computational cost of a query, usually &lt; 1M but can get into the octillions (28 zeros) <span class="emoji" data-emoji="scream">😱</span> <br><br></p>
<h4 id="plans">“plans”</h4>
<p>the number of routes the optimizer has to assess to find the fastest route <br><br></p>
<h4 id="snippets">“snippets”</h4>
<p>the pieces of code that are run independently (???)</p>
</section>
<section id="the-optimizer" class="slide level2">
<h2>The optimizer</h2>
<p>Even though your query seems logical, the optimizer assesses different ways to run it (ex. different join order) and picks the “cheapest” plan to return the data <br></p>
<div class="cell" data-reveal="true" data-fig-width="12" data-eval="true">
<div class="cell-output-display">
<div>
<p>
</p><pre class="mermaid" data-tooltip-selector="#mermaid-tooltip-1">%%{init: {'flowchart':{ 'nodeSpacing': 20, 'rankSpacing': 30} } }%%

flowchart LR
  q([Your Nice Query]) --- o([The Optimizer])
  o ---- p1([Costly Plan]) ---- s1([Snippet]) &amp; s2([Snippet]) &amp; s3([Snippet])
  o ---- p2([Cheaper Plan]) ---- s4([Snippet]) &amp; s5([Snippet]) ---- r([Result])
  
  classDef default fill:black, color:#999, stroke:grey, stroke-width:0px;
  classDef chosen fill:goldenrod, color:#333, stroke:#333, stroke-width:1px;
  class q,o,p2,s4,s5,r chosen;

  linkStyle default stroke-width:2px, fill:none, stroke:goldenrod;
  linkStyle 1,2,3,4 stroke-width:2px, fill:none, stroke:grey;

</pre>
<div id="mermaid-tooltip-1" class="mermaidTooltip">

</div>
<p></p>
</div>
</div>
</div>
<p>“the optimizer should never take more time to optimize a query than it will take to execute it” <a href="https://www.red-gate.com/simple-talk/databases/sql-server/performance-sql-server/join-reordering-and-bushy-plans/">source</a></p>

<aside><div>
<p><a href="https://mermaid.live">editor</a></p>
</div></aside></section>
<section id="why-are-things-slow" class="slide level2">
<h2>Why are things slow?</h2>
<h4 id="not-enough-memory">Not enough memory</h4>
<ul>
<li>too much is being computed (large materialized tables???)</li>
<li>costly queries (full table scans???)</li>
<li>too many plans/snippets</li>
</ul>
<p><br><br></p>
<h4 id="no-available-sessions-slots-for-your-query-to-run">No available sessions (slots???) for your query to run</h4>
<ul>
<li>often your query is stuck in a queue and has not run yet <span class="emoji" data-emoji="scream">😱</span></li>
</ul>
</section>
<section id="order" class="slide level2">
<h2>order</h2>
<ul>
<li><code>FROM</code> &amp; <code>JOIN</code> determine &amp; filter rows</li>
<li><code>WHERE</code> more filters on the rows</li>
<li><code>GROUP BY</code> combines those rows into groups</li>
<li><code>HAVING</code> filters groups</li>
<li><code>SELECT</code> returns and modifies columns</li>
<li><code>DISTINCT</code> removes duplicates</li>
<li><code>ORDER BY</code> arranges the remaining rows/groups</li>
<li><code>LIMIT</code> filters on the remaining rows/groups</li>
</ul>
</section>
<section id="why-staging-tables" class="slide level2">
<h2>Why staging tables?</h2>
<ul>
<li>CTEs aren’t separate tables stored in an environment like in R</li>
<li>The tables are run as sub-queries (???) in subsequent select statements (ex. other CTEs)
<ul>
<li>need to be materialized</li>
</ul></li>
<li>They have little (no?) difference in performance</li>
<li>Biggest benefit is readability &amp; succinctness</li>
</ul>
</section>
<section id="why-group-by-instead-of-distinct" class="slide level2">
<h2>Why <code>group by</code> instead of <code>distinct</code>?</h2>
<p>You can accidentally return duplicate records with <code>distinct</code> + <code>row_number()</code></p>
<div class="columns">
<div class="column">
<p>This can have duplicates</p>
<div class="cell thin_chunk">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="1,3"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">select</span> <span class="kw">distinct</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>  visit_key,</span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="fu">row_number</span>() <span class="kw">over</span> (</span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="kw">partition</span> <span class="kw">by</span> visit_key </span>
<span id="cb1-5"><a href="#cb1-5"></a>    <span class="kw">order</span> <span class="kw">by</span> record_date</span>
<span id="cb1-6"><a href="#cb1-6"></a>  ) <span class="kw">as</span> seq_num</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw">from</span> flowsheet_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is because the <code>distinct</code> happens <br>after the <code>select</code> statement</p>
</div><div class="column">
<p>Instead use</p>
<div class="cell thin_chunk">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="1,3,8"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">select</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  visit_key,</span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="fu">row_number</span>() <span class="kw">over</span> (</span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="kw">partition</span> <span class="kw">by</span> visit_key </span>
<span id="cb2-5"><a href="#cb2-5"></a>    <span class="kw">order</span> <span class="kw">by</span> record_date</span>
<span id="cb2-6"><a href="#cb2-6"></a>  ) <span class="kw">as</span> seq_num</span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="kw">from</span> encounter_all</span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="kw">group</span> <span class="kw">by</span> visit_key</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>or less desirable</p>
<div class="cell thin_chunk">
<div class="sourceCode cell-code" id="cb3" data-code-line-numbers="1,3"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">select</span> <span class="kw">distinct</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  visit_key,</span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">dense_rank</span>() <span class="kw">over</span> (</span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="kw">partition</span> <span class="kw">by</span> visit_key </span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="kw">order</span> <span class="kw">by</span> record_date</span>
<span id="cb3-6"><a href="#cb3-6"></a>  ) <span class="kw">as</span> seq_num</span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="kw">from</span> flowsheet_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>

<aside><div>
<p>https://stackoverflow.com/questions/15476391/fetch-distinct-record-with-join/15477305#15477305</p>
</div></aside></section>
<section id="about-group-by" class="slide level2 smaller">
<h2>About <code>group by</code></h2>
<div class="columns">
<div class="column">
<p>Try not to repeat the same fields over and over</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="2-7,12-17,20-25"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">with</span> ip_visits <span class="kw">as</span> (</span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="kw">select</span> </span>
<span id="cb4-3"><a href="#cb4-3"></a>    visit_key,</span>
<span id="cb4-4"><a href="#cb4-4"></a>    patient_name,</span>
<span id="cb4-5"><a href="#cb4-5"></a>    mrn,</span>
<span id="cb4-6"><a href="#cb4-6"></a>    encounter_date,</span>
<span id="cb4-7"><a href="#cb4-7"></a>    hospital_admission_date,</span>
<span id="cb4-8"><a href="#cb4-8"></a>    <span class="fu">count</span>(<span class="op">*</span>) <span class="kw">as</span> n_records</span>
<span id="cb4-9"><a href="#cb4-9"></a>  <span class="kw">from</span> </span>
<span id="cb4-10"><a href="#cb4-10"></a>    encounter_inpatient</span>
<span id="cb4-11"><a href="#cb4-11"></a>    <span class="kw">join</span> flowsheet_all</span>
<span id="cb4-12"><a href="#cb4-12"></a>  <span class="kw">group</span> <span class="kw">by</span></span>
<span id="cb4-13"><a href="#cb4-13"></a>    visit_key,</span>
<span id="cb4-14"><a href="#cb4-14"></a>    patient_name,</span>
<span id="cb4-15"><a href="#cb4-15"></a>    mrn,</span>
<span id="cb4-16"><a href="#cb4-16"></a>    encounter_date,</span>
<span id="cb4-17"><a href="#cb4-17"></a>    hospital_admission_date</span>
<span id="cb4-18"><a href="#cb4-18"></a>)</span>
<span id="cb4-19"><a href="#cb4-19"></a></span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="kw">select</span></span>
<span id="cb4-21"><a href="#cb4-21"></a>  visit_key,</span>
<span id="cb4-22"><a href="#cb4-22"></a>  patient_name,</span>
<span id="cb4-23"><a href="#cb4-23"></a>  mrn,</span>
<span id="cb4-24"><a href="#cb4-24"></a>  encounter_date,</span>
<span id="cb4-25"><a href="#cb4-25"></a>  hospital_admission_date,</span>
<span id="cb4-26"><a href="#cb4-26"></a>  etc</span>
<span id="cb4-27"><a href="#cb4-27"></a>)</span>
<span id="cb4-28"><a href="#cb4-28"></a><span class="kw">from</span> </span>
<span id="cb4-29"><a href="#cb4-29"></a>  ip_visits</span>
<span id="cb4-30"><a href="#cb4-30"></a>  <span class="kw">join</span> some_other_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column">
<p>keep CTEs as short as possible &amp; join dimensions later</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" data-code-line-numbers="2-3,8-9,12-17"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">with</span> ip_visits <span class="kw">as</span> (</span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="kw">select</span> </span>
<span id="cb5-3"><a href="#cb5-3"></a>    visit_key,</span>
<span id="cb5-4"><a href="#cb5-4"></a>    <span class="fu">count</span>(<span class="op">*</span>) <span class="kw">as</span> n_records</span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="kw">from</span> </span>
<span id="cb5-6"><a href="#cb5-6"></a>    encounter_inpatient</span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="kw">join</span> flowsheet_all</span>
<span id="cb5-8"><a href="#cb5-8"></a>  <span class="kw">group</span> <span class="kw">by</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>    visit_key</span>
<span id="cb5-10"><a href="#cb5-10"></a>)</span>
<span id="cb5-11"><a href="#cb5-11"></a></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="kw">select</span></span>
<span id="cb5-13"><a href="#cb5-13"></a>  visit_key,</span>
<span id="cb5-14"><a href="#cb5-14"></a>  patient_name,</span>
<span id="cb5-15"><a href="#cb5-15"></a>  mrn,</span>
<span id="cb5-16"><a href="#cb5-16"></a>  encounter_date,</span>
<span id="cb5-17"><a href="#cb5-17"></a>  hospital_admission_date,</span>
<span id="cb5-18"><a href="#cb5-18"></a>  n_records</span>
<span id="cb5-19"><a href="#cb5-19"></a><span class="kw">from</span> </span>
<span id="cb5-20"><a href="#cb5-20"></a>  ip_visits</span>
<span id="cb5-21"><a href="#cb5-21"></a>  <span class="kw">join</span> encounter_inpatient</span>
<span id="cb5-22"><a href="#cb5-22"></a>  <span class="kw">join</span> some_other_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="ctes" class="slide level2">
<h2>CTEs</h2>
<ul>
<li>Better to put a complicated CTE in a staging table
<ul>
<li>CTE results are not stored to the side like in R or python</li>
<li>Snippets are run in parallel and CTE is calculated each time it is called</li>
</ul></li>
<li>Keep as short as possible
<ul>
<li>add filters here rather than in final <code>select</code> statement ex. don’t do <code>select * from note_text</code></li>
</ul></li>
<li><code>order by</code> in a CTE just adds cost and does not affect final results</li>
</ul>
</section>
<section id="full-table-scans" class="slide level2">
<h2>Full Table Scans</h2>
</section>
<section id="avoid-using-functions-in-predicates-where-on" class="slide level2">
<h2>Avoid using functions in predicates (<code>where</code> &amp; <code>on</code>)</h2>
<h3 id="slower">Slower</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="1,4"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">-- cost = 244</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">select</span> <span class="op">*</span> </span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="kw">from</span> chop_analytics.<span class="kw">admin</span>.encounter_office_visit_all</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="kw">where</span> <span class="kw">hour</span>(appointment_date) <span class="op">=</span> <span class="dv">10</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<h3 id="faster">Faster</h3>
<p>We added <code>scheduled_appointment_time_of_day</code> as a numeric field so it is easier to plot but also easier to query</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" data-code-line-numbers="1,4"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">-- cost =  59</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">select</span> <span class="op">*</span> </span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="kw">from</span> chop_analytics.<span class="kw">admin</span>.encounter_office_visit_completed</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="kw">where</span> scheduled_appointment_time_of_day <span class="kw">between</span> <span class="dv">10</span> <span class="kw">and</span> <span class="fl">10.99</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<h3 id="suggestion">Suggestion</h3>
<p>Put these transformations in the in your staging tables</p>
</section>
<section id="www.techagilist.com" class="slide level2">
<h2>www.techagilist.com</h2>
<ul>
<li><a href="https://www.techagilist.com/mainframe/db2/db2-predicates-performance-tuning-db2-queries/">source</a></li>
<li>stage 1 - no table scan
<ul>
<li>indexable - <strong>first</strong>
<ul>
<li>column + operator such as <code>=</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code></li>
<li><code>between</code>, <code>in</code> and <code>like 'abc%'</code> (no leading wildcard)</li>
</ul></li>
<li>non-indexable - <strong>second</strong>
<ul>
<li>column + <code>!=</code>, <code>not between</code> and <code>not like</code></li>
</ul></li>
</ul></li>
<li>stage 2 - <strong>third</strong> - has full table scan
<ul>
<li>functions on column <code>substr(x, 1, 1) = 'B'</code></li>
<li>if field is varchar(8) and you ask it to evaluate a string of length 10</li>
</ul></li>
<li>order within stages
<ul>
<li>equality &amp; <code>in (one_value)</code></li>
<li>ranges and <code>x is not null</code></li>
<li>all others</li>
</ul></li>
<li>compound predicates will take the higher stage
<ul>
<li><code>x = 'y' or x &lt;&gt; 'z'</code> -&gt; stage 1, non-indexable</li>
<li><code>x = 'y' or substr(x, 1, 1) = 'z'</code> -&gt; stage 2</li>
</ul></li>
<li><code>x between y and z</code> is more efficient than <code>x &lt;=y and x &gt;= z</code></li>
</ul>
</section>
<section id="www.informit.com" class="slide level2">
<h2>www.informit.com</h2>
<ul>
<li><a href="https://www.informit.com/articles/article.aspx?p=27015&amp;seqNum=5">source</a></li>
<li>These will invalidate indexing
<ul>
<li>Comparing columns in the same table</li>
<li>Choosing columns with low-selectivity indexes (maybe not applicable?)</li>
<li>Doing math on a column before comparing it to a constant</li>
<li>Applying a function to column data before comparing it to a constant</li>
<li>Finding ranges with BETWEEN</li>
<li>Matching with LIKE</li>
<li>Comparing to NULL</li>
<li>Negating with NOT</li>
<li>Converting values</li>
<li>Using OR</li>
<li>Finding sets of values with IN</li>
<li>Using multicolumn indexes</li>
</ul></li>
</ul>
</section>
<section id="nasis.sc.egov.usda.gov" class="slide level2">
<h2>nasis.sc.egov.usda.gov</h2>
<ul>
<li><a href="https://nasis.sc.egov.usda.gov/NasisReportsWebSite/limsreport.aspx?report_name=SDA-Tips">source</a></li>
<li><code>GROUP BY</code> or <code>ORDER BY</code> are not used unnecessarily</li>
<li>It is fast or faster to <code>SELECT</code> by actual column name(s) than to use an asterisk. The larger the table, the more likely you will save time.</li>
<li>Perform functions instead of comparisons on the data objects referenced in the <code>WHERE</code> clause. (<code>x &gt; 0</code> rather than <code>x != 0</code>)</li>
<li>Make the table with the least number of rows the driving table. Do this by making it first in the <code>FROM</code> clause.</li>
<li>The <code>OVER</code> clause with an aggregate function is similar to, but more efficient than, a subquery.</li>
</ul>
</section>
<section id="www.ibm.com" class="slide level2">
<h2>www.ibm.com</h2>
<ul>
<li><a href="https://www.ibm.com/docs/en/db2-for-zos/12?topic=queries-coding-sql-statements-avoid-unnecessary-processing">source</a></li>
<li>stage 1 (before returned) vs stage 2 (after returned)</li>
<li><a href="https://www.ibm.com/docs/en/db2-for-zos/12?topic=selection-stage-1-stage-2-predicates">selection-stage-1-stage-2-predicates</a>
<ul>
<li>predicates associated with columns or constants of the DECFLOAT data type are never treated as stage 1</li>
</ul></li>
<li><a href="https://www.ibm.com/docs/en/db2-for-zos/12?topic=selection-examples-predicate-properties">selection-examples-predicate-properties</a></li>
<li><a href="https://www.ibm.com/docs/en/db2-for-zos/12?topic=factors-default-filter-simple-predicates">factors-default-filter-simple-predicates</a></li>
<li><a href="https://www.ibm.com/docs/en/db2-for-zos/12?topic=efficiently-adding-extra-predicates-improve-access-paths">efficiently-adding-extra-predicates-improve-access-paths</a></li>
<li><a href="https://www.ibm.com/docs/en/db2-for-zos/12?topic=manipulation-removal-pre-evaluated-predicates">manipulation-removal-pre-evaluated-predicates</a>
<ul>
<li>Db2 does not remove OR 0=1 or OR 0&lt;&gt;0 predicates. Predicates of these forms can be used to prevent index access.</li>
</ul></li>
<li><a href="https://www.ibm.com/docs/en/db2-for-zos/12?topic=queries-making-predicates-eligible-expression-based-indexes">queries-making-predicates-eligible-expression-based-indexes</a>
<ul>
<li>subquery for <code>upper()</code>?</li>
</ul></li>
</ul>
</section>
<section id="www.ibm.com-1" class="slide level2">
<h2>www.ibm.com</h2>
<ul>
<li><p><a href="https://www.ibm.com/docs/en/db2-for-zos/12?topic=efficiently-summary-predicate-processing">list of stage 1 vs stage 2</a></p>
<ul>
<li>see also <a href="https://www.ibm.com/docs/en/db2-for-zos/11?topic=efficiently-summary-predicate-processing#db2z_summarypredicateprocessing__bkn9pred1187154">explanation</a></li>
</ul></li>
</ul>
</section>
<section id="predicates" class="slide level2">
<h2>Predicates</h2>
<p>imported via CSV example</p>
<div class="cell">
<div class="cell-output-display">

<div id="vwekemmusf" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: Courier;
}

#vwekemmusf .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 11px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vwekemmusf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vwekemmusf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vwekemmusf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vwekemmusf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vwekemmusf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vwekemmusf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vwekemmusf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vwekemmusf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vwekemmusf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vwekemmusf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vwekemmusf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#vwekemmusf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vwekemmusf .gt_from_md > :first-child {
  margin-top: 0;
}

#vwekemmusf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vwekemmusf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vwekemmusf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vwekemmusf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vwekemmusf .gt_row_group_first td {
  border-top-width: 2px;
}

#vwekemmusf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vwekemmusf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vwekemmusf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vwekemmusf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vwekemmusf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vwekemmusf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vwekemmusf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vwekemmusf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vwekemmusf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vwekemmusf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vwekemmusf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vwekemmusf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vwekemmusf .gt_left {
  text-align: left;
}

#vwekemmusf .gt_center {
  text-align: center;
}

#vwekemmusf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vwekemmusf .gt_font_normal {
  font-weight: normal;
}

#vwekemmusf .gt_font_bold {
  font-weight: bold;
}

#vwekemmusf .gt_font_italic {
  font-style: italic;
}

#vwekemmusf .gt_super {
  font-size: 65%;
}

#vwekemmusf .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#vwekemmusf .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#vwekemmusf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vwekemmusf .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#vwekemmusf .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#vwekemmusf .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">logic</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">indexible</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">stage 1</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">stage 2</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left"><div class="gt_from_md"><p>between</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"><p>col between value1 and value2<br>col between noncol expr1 and noncol expr2<br>value between col1 and col2<br>col between expression1 and expression2</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"><p>col not between value1 and value2<br>col not between noncol expr1 and noncol expr2</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"><p>col between col1 and col2<br>value not between col1 and col2</p>
</div></td></tr>
    <tr><td class="gt_row gt_left"><div class="gt_from_md"><p>distinct</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"><p>col is not distinct from value<br>col is not distinct from noncol expr<br>t1.col1 is not distinct from t2.col2<br>t1.col1 is not distinct from t2 col expr</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"><p>col is distinct from value<br>col is distinct from noncol expr<br>t1.col1 is distinct from t2 col expr</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"><p>t1.col1 is distinct from t2.col2</p>
</div></td></tr>
    <tr><td class="gt_row gt_left"><div class="gt_from_md"><p>equality</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"><p>col = value<br>col = noncol expr<br>t1.col = t2 col expr<br>t1.col1 = t1.col2<br>substr(col, 1, n)=value<br>date(col) = value<br>year(col) = value</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"></div></td>
<td class="gt_row gt_left"><div class="gt_from_md"><p>expression = value</p>
</div></td></tr>
    <tr><td class="gt_row gt_left"><div class="gt_from_md"><p>in</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"><p>col in (list)</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"><p>col not in(list)</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"></div></td></tr>
    <tr><td class="gt_row gt_left"><div class="gt_from_md"><p>inequality</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"></div></td>
<td class="gt_row gt_left"><div class="gt_from_md"><p>col &lt;&gt; value<br>col &lt;&gt; noncol expr<br>t1.col &lt;&gt; tc col expr</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"><p>t1.col1 &lt;&gt; t1.col2<br>expression &lt;&gt; value</p>
</div></td></tr>
    <tr><td class="gt_row gt_left"><div class="gt_from_md"><p>like</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"><p>col like ‘pattern’<br>col like host variable<br>col like upper(‘pattern’)<br>col like upper(host-variable)<br>col like upper(global-variable)<br>col like upper(cast(host-variable as data-type)<br>col like upper(cast(sql-variable as data-type)<br>col like upper(cast(global-variable as data-type)</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"><p>col not like ‘char’<br>col like ‘%char’<br>col like ‘_char’</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"></div></td></tr>
    <tr><td class="gt_row gt_left"><div class="gt_from_md"><p>null</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"><p>col is null<br>col is not null</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"></div></td>
<td class="gt_row gt_left"><div class="gt_from_md"></div></td></tr>
    <tr><td class="gt_row gt_left"><div class="gt_from_md"><p>operator</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"><p>col op value<br>col op noncol expr<br>t1.col op t2 col expr<br>t1.col1 op t1.col2<br>substr(col, 1, n) op value<br>date(col) op value<br>year(col) op value</p>
</div></td>
<td class="gt_row gt_left"><div class="gt_from_md"></div></td>
<td class="gt_row gt_left"><div class="gt_from_md"><p>expression op value</p>
</div></td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</section>
<section id="predicates-1" class="slide level2 smaller">
<h2>Predicates</h2>
<p>manually curated</p>
<table style="width:100%;">
<colgroup>
<col style="width: 13%">
<col style="width: 35%">
<col style="width: 23%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Fastest (indexable)</th>
<th>Slower (stage 1)</th>
<th>Slowest (stage 2)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>in</code></td>
<td>col in ()</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>between</code></td>
<td>col between 5 and 10<br>
5 between col_1 and col_2<br>
</td>
<td>col not between 5 and 10</td>
<td>col between col_2 and col_3<br>
5 not between col_1 and col_2</td>
</tr>
<tr class="odd">
<td><code>null</code></td>
<td></td>
<td>is null<br>
is not null</td>
<td></td>
</tr>
<tr class="even">
<td><code>like</code></td>
<td>like ‘abc%’<br>
like lower(‘abc%’)</td>
<td>like ‘%abc%’<br>
not like ‘abc%’</td>
<td></td>
</tr>
<tr class="odd">
<td>equality</td>
<td>col = 123<br>
col = noncol expr<br>
col = lower(‘abc’)<br>
col &gt; 123</td>
<td>col &lt;&gt; 123</td>
<td>col &lt;&gt; col_2</td>
</tr>
</tbody>
</table>
</section>
<section id="www.ibm.com-2" class="slide level2">
<h2>www.ibm.com</h2>
<ul>
<li><a href="https://www.ibm.com/docs/en/db2-for-zos/12?topic=processing-using-non-column-expressions-efficiently">source</a></li>
<li>Where possible, use a non-column expression (put the column on one side of the operator and all other values on the other)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">where</span> (x <span class="op">*</span> <span class="dv">2</span>) <span class="op">&lt;</span> <span class="dv">20</span></span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co">-- preferred</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="kw">where</span> x <span class="op">&lt;</span> <span class="dv">20</span> <span class="op">/</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="www.sisense.com" class="slide level2">
<h2>www.sisense.com</h2>
<ul>
<li><a href="https://www.sisense.com/blog/8-ways-fine-tune-sql-queries-production-databases/">source</a></li>
<li>use <code>where</code> instead of <code>having</code> - doesn’t require a full index search</li>
<li>wildcards at the end only preferred <code>'abc%'</code> instead of <code>'%abc%'</code></li>
</ul>
</section>
<section id="arctype.com" class="slide level2">
<h2>arctype.com</h2>
<ul>
<li><a href="https://arctype.com/blog/optimize-sql-query/">source</a></li>
<li>the larger the number of rows, the higher the probability of slow performance.</li>
<li>The run time of an SQL query increases every time a table join is implemented. This is because joins increase the number of rows—and in many cases, columns—in the output. To rectify this situation, the size of the table should be reduced (as previously suggested) before joining.</li>
<li><code>limit</code> + a <code>group by</code> happens after and won’t affect runtime</li>
</ul>
</section>
<section id="blog.jooq.org" class="slide level2">
<h2>blog.jooq.org</h2>
<ul>
<li><a href="https://blog.jooq.org/avoid-using-count-in-sql-when-you-could-use-exists/">source</a></li>
<li>use <code>exists()</code> instead of <code>count()</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1"></a><span class="co">-- slower, cost = 123</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw">select</span> </span>
<span id="cb9-3"><a href="#cb9-3"></a> a.name,</span>
<span id="cb9-4"><a href="#cb9-4"></a> <span class="fu">count</span>(<span class="op">*</span>) <span class="op">&gt;</span> <span class="dv">10</span> <span class="kw">as</span> n_film</span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="kw">from</span> actor      a</span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="kw">join</span> film_actor f <span class="kw">on</span> f.actor_id <span class="op">=</span> a.actor_id</span>
<span id="cb9-7"><a href="#cb9-7"></a>;</span>
<span id="cb9-8"><a href="#cb9-8"></a></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co">-- faster, cost = 3.4</span></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="kw">select</span> </span>
<span id="cb9-11"><a href="#cb9-11"></a>  a.name,</span>
<span id="cb9-12"><a href="#cb9-12"></a>  <span class="kw">exists</span> (</span>
<span id="cb9-13"><a href="#cb9-13"></a>    <span class="kw">select</span> <span class="op">*</span> </span>
<span id="cb9-14"><a href="#cb9-14"></a>    <span class="kw">from</span> actor      a</span>
<span id="cb9-15"><a href="#cb9-15"></a>    <span class="kw">join</span> film_actor f <span class="kw">on</span> f.actor_id <span class="op">=</span> a.actor_id</span>
<span id="cb9-16"><a href="#cb9-16"></a>    <span class="kw">where</span> a.last_name <span class="op">=</span> <span class="st">'WAHLBERG'</span></span>
<span id="cb9-17"><a href="#cb9-17"></a>  ) <span class="kw">as</span> n_film</span>
<span id="cb9-18"><a href="#cb9-18"></a>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>rationale</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1"></a><span class="co">// EXISTS</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="cf">if</span> (<span class="op">!</span>collection<span class="op">.</span><span class="fu">isEmpty</span>())</span>
<span id="cb10-3"><a href="#cb10-3"></a>    <span class="fu">doSomething</span>()<span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4"></a> </span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co">// COUNT(*)</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="cf">if</span> (collection<span class="op">.</span><span class="fu">size</span>() <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb10-7"><a href="#cb10-7"></a>    <span class="fu">doSomething</span>()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="www.metabase.com" class="slide level2">
<h2>www.metabase.com</h2>
<ul>
<li><a href="https://www.metabase.com/learn/sql-questions/sql-best-practices#sql-best-practices-for-from">source</a></li>
<li>adding table alias to column is faster, prevents column name search</li>
<li>filter <code>WHERE</code> before <code>HAVING</code></li>
<li><code>||</code> is a function -&gt; stage 2 bad: <code>hero || sidekick = 'BatmanRobin'</code> good: <code>hero = 'Batman' AND sidekick = 'Robin'</code></li>
<li>use <code>EXISTS</code> vs <code>IN</code></li>
<li>order <code>GROUP BY</code> columns by more unique values first (descending cardinality)</li>
<li><code>UNION ALL</code> vs <code>UNION</code></li>
<li>Use <code>CREATE INDEX</code> ?</li>
</ul>
</section>
<section id="sqlmaestros.com" class="slide level2">
<h2>sqlmaestros.com</h2>
<ul>
<li><a href="https://sqlmaestros.com/sargability-cast-convert-more/">source</a></li>
<li>sargable predicates (conditions) can be filtered before results are returned
<ul>
<li><strong><code>S</code></strong>earch <strong><code>ARG</code></strong>ument <strong><code>ABLE</code></strong></li>
</ul></li>
<li>sargable
<ul>
<li><code>where x between '2021/01/01' and '2021/12/31'</code></li>
</ul></li>
<li>non-sargable
<ul>
<li><code>where year(x) = 2021</code></li>
</ul></li>
</ul>
</section>
<section id="towardsdatascience.com" class="slide level2">
<h2>towardsdatascience.com</h2>
<ul>
<li><a href="https://towardsdatascience.com/14-ways-to-optimize-bigquery-sql-for-ferrari-speed-at-honda-cost-632ec705979">source</a></li>
<li><code>exists</code> better than <code>count</code> better than <code>count distinct</code></li>
<li>avoid self joins with window functions like <code>lead()</code> &amp; <code>lag()</code></li>
<li>join on integers better than strings</li>
<li>anti-join best as <code>except distinct</code> better than <code>not exists</code> better than <code>left join</code> better than <code>not in</code></li>
<li>trim data early and often</li>
<li><code>where</code> order should be most filtered first (optimizer might handle this)</li>
<li>use <code>CREATE TABLE xyz PARTITIONED BY abc CLUSTER BY</code></li>
<li>only use <code>ORDER BY</code> at the final query (if at all) (optimizer might handle this)</li>
<li>use functions at the end rather than in CTEs (ex. <code>regexp_replace()</code>)</li>
</ul>
</section>
<section id="www.sqlshack.com" class="slide level2">
<h2>www.sqlshack.com</h2>
<ul>
<li><a href="https://www.sqlshack.com/query-optimization-techniques-in-sql-server-tips-and-tricks/">source</a></li>
<li>replace <code>join on x or y</code> with <code>union all</code></li>
<li>over-indexing write is slow</li>
<li>under-indexing read is slow</li>
<li>fewer tables = less cost -&gt; blocks better than base</li>
<li>“left-deep tree” (linear) better than “bushy tree”
<ul>
<li>bushy: <code>A join B, A join C, B join D, C join E</code>
<ul>
<li>With 12 tables in a bushy query, the math would work out to:</li>
<li>(2n-2)! / (n-1)! = (2*12-1)! / (12-1)! = 28,158,588,057,600 possible execution plans.</li>
</ul></li>
<li>deep-tree: <code>A join B, B join C, C join D, D join E</code>
<ul>
<li>If the query had been more linear in nature, then we would have:</li>
<li>n! = 12! = 479,001,600 possible execution plans.</li>
</ul></li>
</ul></li>
<li>joins that are used to return a single constant can be moved to a parameter or variable</li>
<li>query hints (SQL server only?)</li>
</ul>
</section>
<section id="bushy-vs-deep-tree" class="slide level2">
<h2>bushy vs deep-tree</h2>
<p>??? Does this mean we should write our joins a particular way? Does this apply to Netezza?</p>
<div class="columns">
<div class="column">
<p>Bushy</p>
<div class="cell" data-reveal="true" data-eval="true">
<div class="cell-output-display">
<div>
<p>
</p><pre class="mermaid" data-tooltip-selector="#mermaid-tooltip-2">%%{init: {'theme': 'base', 'themeVariables': { 'edgeLabelBackground': '#444'}}}%%
flowchart TD
  A1[A] -- visit_key--- B1[B] -- order_key ---C1[C]
  A1 -- pat_key--- D1[D] -- zip_code--- E1[E]
  
  classDef default color:black, fill:white, stroke:black, stroke-width:1px;
  linkStyle default color:#aaa, fill:none, stroke:white, stroke-width:1px;
</pre>
<div id="mermaid-tooltip-2" class="mermaidTooltip">

</div>
<p></p>
</div>
</div>
</div>
</div><div class="column">
<p>Deep Tree</p>
<div class="cell" data-reveal="true" data-eval="true">
<div class="cell-output-display">
<div>
<p>
</p><pre class="mermaid" data-tooltip-selector="#mermaid-tooltip-3">%%{init: {'theme': 'base', 'themeVariables': { 'edgeLabelBackground': '#444'}}}%%
flowchart TD
  A2[A] --visit_key--- B2[B] -- order_key --- C2[C] -- pat_key --- D2[D] -- zip_code --- E2[E]
  
  classDef default color:black, fill:white, stroke:black, stroke-width:1px;
  linkStyle default color:#aaa, fill:none, stroke:white, stroke-width:1px;
</pre>
<div id="mermaid-tooltip-3" class="mermaidTooltip">

</div>
<p></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="www.sqlshack.com-1" class="slide level2">
<h2>www.sqlshack.com</h2>
<ul>
<li><p><a href="https://www.sqlshack.com/query-optimization-techniques-in-sql-server-the-basics/">source</a></p>
<ul>
<li><code>where x like 'abc%'</code> better than <code>where left(x, 3) = 'abc'</code></li>
</ul></li>
<li><p>don’t rely on implcit conversion as it converts everything then filters use <code>where x = '123'</code> better than <code>where x = 123</code></p></li>
<li><p><a href="https://www.sqlshack.com/query-optimization-in-sql-server-for-beginners/">source</a></p></li>
<li><p>trace flags? (not sure what these are)</p></li>
</ul>
</section>
<section id="www.idug.org" class="slide level2">
<h2>www.idug.org</h2>
<ul>
<li><a href="https://www.idug.org/browse/blogs/blogviewer?blogkey=bd88bb79-dc28-4b73-be0b-bea9858513f3">article</a></li>
<li><a href="https://www.youtube.com/watch?v=FIVDmEIjBZA">youtube</a></li>
</ul>
</section>
<section id="hosteddocs.ittoolbox.com" class="slide level2">
<h2>hosteddocs.ittoolbox.com</h2>
<ul>
<li><a href="http://hosteddocs.ittoolbox.com/Questnolg22106sqltips.pdf">source</a></li>
</ul>
</section>
<section id="checking" class="slide level2">
<h2>checking</h2>
<ul>
<li>you can check with</li>
<li>this only holds the last 5K queries in the CDW (can go by quickly)</li>
<li>you can explore plans with <code>show planfile 12345678</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">select</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>    qh_tsubmit,</span>
<span id="cb11-3"><a href="#cb11-3"></a>    qh_tstart,</span>
<span id="cb11-4"><a href="#cb11-4"></a>    qh_tend,</span>
<span id="cb11-5"><a href="#cb11-5"></a>    qh_tend:<span class="ch">:timestamp</span> <span class="op">-</span> qh_tstart:<span class="ch">:timestamp</span> </span>
<span id="cb11-6"><a href="#cb11-6"></a>        <span class="kw">as</span> runtime_s,           <span class="co">-- &gt; 180s</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>    qh_estcost,                 <span class="co">-- &gt; 1,000,000</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>    qh_snippets,                <span class="co">-- &gt; 20</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>    <span class="fu">length</span>(qh_sql) <span class="kw">as</span> n_char,  <span class="co">-- &gt; 6000</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>    qh_resrows,</span>
<span id="cb11-11"><a href="#cb11-11"></a>    qh_resbytes,</span>
<span id="cb11-12"><a href="#cb11-12"></a>    qh_user,</span>
<span id="cb11-13"><a href="#cb11-13"></a>    qh_database,</span>
<span id="cb11-14"><a href="#cb11-14"></a>    qh_sql,</span>
<span id="cb11-15"><a href="#cb11-15"></a>    qh_sessionid,</span>
<span id="cb11-16"><a href="#cb11-16"></a>    qh_planid <span class="co">--planfile id</span></span>
<span id="cb11-17"><a href="#cb11-17"></a><span class="kw">from</span> </span>
<span id="cb11-18"><a href="#cb11-18"></a>    _v_qryhist </span>
<span id="cb11-19"><a href="#cb11-19"></a><span class="kw">where</span></span>
<span id="cb11-20"><a href="#cb11-20"></a>    qh_user <span class="op">=</span> current_user</span>
<span id="cb11-21"><a href="#cb11-21"></a><span class="kw">order</span> <span class="kw">by</span> </span>
<span id="cb11-22"><a href="#cb11-22"></a>    <span class="dv">1</span> <span class="kw">desc</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="suggestions-for-users" class="slide level2">
<h2>Suggestions for users</h2>
<ul>
<li>do transforms in staging table to make <code>where</code> statements faster</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1"></a><span class="co">-- faster (stage 1)</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="kw">where</span> hour_start <span class="op">&lt;</span> <span class="dv">7</span></span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co">-- slower (stage 2)</span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="kw">where</span> <span class="kw">hour</span>(query_start_date) <span class="op">&lt;</span> <span class="dv">7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li></li>
</ul>
</section>
<section id="suggestions-for-blocks" class="slide level2">
<h2>Suggestions for blocks</h2>
<ul>
<li>change all mixed case to lower case to avoid <code>where lower(procedure_name) in ()</code></li>
<li>add fiscal year to applicable blocks</li>
</ul>
</section>
<section id="record-size" class="slide level2">
<h2>Record size</h2>
<ul>
<li>explain <a href="https://www.ibm.com/support/pages/record-size-exceeds-internal-limit-65535-bytes">Record size exceeds internal limit of 65535 bytes</a></li>
</ul>
</section>
<section id="resources" class="slide level2">
<h2>Resources</h2>
<p>You can learn more about SQL optimization here:</p>
<ul>
<li><p><a href="https://github.research.chop.edu/sardanam/sql-best-practices/blob/master/sql-performance/sql_best_practices.md">Mayank’s Tutorial</a></p></li>
<li></li>
</ul>
</section>
<section id="appendix" class="slide level2">
<h2>Appendix</h2>
<ul>
<li>group by vs distinct https://sqlstudies.com/2017/03/06/using-group-by-instead-of-distinct/ https://sqlperformance.com/2017/01/t-sql-queries/surprises-assumptions-group-by-distinct</li>
</ul>
</section>
<section id="open-questions" class="slide level2">
<h2>Open questions</h2>
<ul>
<li>do we use indexing?
<ul>
<li>does stage 1 indexable only work if table is indexed or is indexable something that happens at runtime?<br>
ex: col between 5 and 10</li>
</ul></li>
<li>would <a href="https://dba.stackexchange.com/questions/111584/how-to-increase-etl-performance-in-informatica-for-netezza-as-a-source-and-sql-s">this</a> help re: informatica?</li>
<li>can we use <a href="https://medium.com/@rleishman/netezza-zone-maps-theyre-the-same-as-indexes-right-fb3249f01cea">zone maps</a></li>
</ul>
</section>
<section id="end" class="slide level2">
<h2>–END–</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>knitr<span class="sc">::</span><span class="fu">knit_exit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer footer-default">

</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="README_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="README_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="README_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="README_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="README_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="README_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="README_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="README_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="README_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="README_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: true,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1200,

        height: 750,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        function fireSlideChanged(previousSlide, currentSlide) {

          // dispatch for htmlwidgets
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for reveal
        if (window.Reveal) {
          window.Reveal.addEventListener("slidechanged", function(event) {
            fireSlideChanged(event.previousSlide, event.currentSlide);
          });
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        setTimeout(function() {
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto-reveal',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          let href = ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const cites = ref.parentNode.getAttribute('data-cites').split(' ');
        tippyHover(ref, function() {
          var popup = window.document.createElement('div');
          cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    });
    </script>
    

</body></html>
